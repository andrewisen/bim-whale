on: push
name: Deploy the BIM Whale
jobs:
    web-deploy:
        name: Deploy BIMWHALE.js
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v2.3.2
            - name: Build
              run: |
                  sudo curl -fsSL https://deno.land/x/install/install.sh | sh
                  deno test tests/ --allow-read
                  sudo npm install
                  sudo npm run build
                  sudo npm run docs
                  sudo touch docs/.ftp-deploy-sync-state.json
                  sudo chmod 777 docs/.ftp-deploy-sync-state.json

            - name: Sync Files
              uses: SamKirkland/FTP-Deploy-Action@4.0.0
              with:
                  server: ftpcluster.loopia.se
                  username: bim-whale-github-actions-ftp
                  password: ${{ secrets.password }}
                  local-dir: docs/
                  server-dir: public_html/docs/
